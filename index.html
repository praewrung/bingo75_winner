<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bingo 75 Who is the Winner.</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#0f0f0f;
  color:#fff;
  margin:0;
  padding:12px;
}

h1 {
  text-align:center;
  margin:10px 0 16px;
}

h2 {
  font-size:18px;
  margin-bottom:8px;
}

.box {
  background:#1c1c1e;
  padding:14px;
  border-radius:16px;
  margin-bottom:16px;
}

input {
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:12px;
  border:none;
  margin-bottom:10px;
}

button {
  width:100%;
  padding:14px;
  font-size:16px;
  border:none;
  border-radius:14px;
  margin-top:6px;
}

.green { background:#34c759; color:#000; }
.gray  { background:#3a3a3c; color:#fff; }
.red   { background:#ff453a; color:#fff; }

/* ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô */
.player-row {
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:#2c2c2e;
  padding:10px 14px;
  border-radius:12px;
  margin-bottom:8px;
}

.player-row button {
  width:auto;
  padding:6px 10px;
  font-size:14px;
  border-radius:8px;
}

/* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ */
.winner-grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}

.winner-card {
  background:#2c2c2e;
  padding:12px;
  border-radius:12px;
  text-align:center;
}

.winner-card input {
  display:none;
}

.winner-card label {
  display:block;
  cursor:pointer;
}

.winner-card input:checked + label {
  background:#34c759;
  color:#000;
  border-radius:10px;
  padding:8px;
}

/* ‡∏™‡∏£‡∏∏‡∏õ */
.summary-row {
  background:#2c2c2e;
  padding:10px;
  border-radius:12px;
  margin-bottom:6px;
  font-size:14px;
}
</style>

</head>

<body>

<h1>üé± Bingo 75 ‡πÉ‡∏Ñ‡∏£‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô</h1>

<!-- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô -->
<div class="box">
<h2>üë• ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
<input id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
<button class="green" onclick="addPlayer()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
<div id="playerList"></div>
</div>

<!-- ‡∏à‡∏ö‡∏ï‡∏≤ -->
<div class="box">
<h2>üí∞ ‡∏à‡∏ö‡∏ï‡∏≤</h2>
<input id="bet" type="number" placeholder="‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏≤ (‡∏ö‡∏≤‡∏ó)">
<div id="winnerList"></div>
<button class="green" onclick="endRound()">‡∏à‡∏ö‡∏ï‡∏≤ (‡∏°‡∏µ Bingo)</button>
<button class="gray" onclick="undoRound()">‚Ü©Ô∏è Undo ‡∏ï‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
</div>

<!-- ‡∏™‡∏£‡∏∏‡∏õ -->
<div class="box">
<h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô (‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</h2>
<div id="summary"></div>
<button class="gray" onclick="endGameKeepLog()">üßπ ‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡πà‡∏ô (‡πÄ‡∏Å‡πá‡∏ö Log)</button>
</div>

<!-- Log -->
<div class="box">
<h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (Log)</h2>

<div style="margin:8px 0">
  <button class="green" onclick="exportLogImage()">üì§ Export ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ</button>
  <button class="gray" onclick="renderTotalNet()">üî¢ ‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏∑‡∏ô</button>
  <button class="red" onclick="clearLog()">üóëÔ∏è ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

</div>

<div id="totalNet"></div>
<div id="logTable"></div>
</div>

<script>
let players = JSON.parse(localStorage.getItem("players")) || [];
let rounds  = JSON.parse(localStorage.getItem("rounds")) || [];
let gameHistory = JSON.parse(localStorage.getItem("gameHistory")) || [];

function save() {
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("rounds", JSON.stringify(rounds));
  localStorage.setItem("gameHistory", JSON.stringify(gameHistory));
}

/* ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô */
function addPlayer() {
  const input = document.getElementById("playerName");
  const name = input.value.trim();
  if (!name) return;
  if (players.find(p => p.name === name)) {
    alert("‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß");
    return;
  }
  players.push({ name, paid:0, win:0 });
  input.value = "";
  save(); render();
}

function removePlayer(name) {
  if (!confirm(`‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${name} ? (‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡∏≤‡πÄ‡∏Å‡πà‡∏≤)`)) return;
  players = players.filter(p => p.name !== name);
  save(); render();
}

/* ‡∏à‡∏ö‡∏ï‡∏≤ */
function endRound() {
  const bet = Number(document.getElementById("bet").value);
  const checked = document.querySelectorAll(".winner:checked");
  if (!bet || checked.length === 0) {
    alert("‡πÉ‡∏™‡πà‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞");
    return;
  }

  const participants = players.map(p => p.name);
  const winners = Array.from(checked).map(c => c.value);
  const totalPot = bet * participants.length;
  const winPerPerson = totalPot / winners.length;

  players.forEach(p => {
    if (participants.includes(p.name)) p.paid += bet;
    if (winners.includes(p.name)) p.win += winPerPerson;
  });

  rounds.push({ bet, participants, winners });
  save(); render();
}

/* Undo */
function undoRound() {
  if (rounds.length === 0) return;
  const last = rounds.pop();
  const totalPot = last.bet * last.participants.length;
  const winPerPerson = totalPot / last.winners.length;

  players.forEach(p => {
    if (last.participants.includes(p.name)) p.paid -= last.bet;
    if (last.winners.includes(p.name)) p.win -= winPerPerson;
  });

  save(); render();
}

/* ‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡πà‡∏ô ‡πÄ‡∏Å‡πá‡∏ö log */
function endGameKeepLog() {
  if (rounds.length === 0) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
    return;
  }

  const summary = players.map(p => ({
    name:p.name,
    paid:p.paid,
    win:p.win,
    net:p.win - p.paid
  }));

  gameHistory.push({
    date: new Date().toLocaleString("th-TH"),
    rounds: JSON.parse(JSON.stringify(rounds)),
    summary
  });

  rounds = [];
  players.forEach(p => { p.paid = 0; p.win = 0; });

  save(); render();
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üéâ");
}

/* ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
function render() {
  document.getElementById("playerList").innerHTML =
  players.map(p => `
    <div class="player-row">
      <span>${p.name}</span>
      <button class="red" onclick="removePlayer('${p.name}')">‡∏•‡∏ö</button>
    </div>
  `).join("");


  document.getElementById("winnerList").innerHTML = `
  <div class="winner-grid">
    ${players.map(p => `
      <div class="winner-card">
        <input id="w_${p.name}" class="winner" type="checkbox" value="${p.name}">
        <label for="w_${p.name}">${p.name}</label>
      </div>
    `).join("")}
  </div>
`;


  document.getElementById("summary").innerHTML =
    players.map(p => {
      const net = p.win - p.paid;
      const color = net >= 0 ? "#4caf50" : "#f44336";
      return `<div style="color:${color}">
        ${p.name} | ‡∏•‡∏á ${p.paid} | ‡πÑ‡∏î‡πâ ${p.win} | ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ${net}
      </div>`;
    }).join("");

  renderLogTable();
}

/* Log ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
function renderLogTable() {
  const div = document.getElementById("logTable");
  if (gameHistory.length === 0) {
    div.innerHTML = "<div style='color:#aaa'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Log</div>";
    return;
  }

  div.innerHTML = gameHistory.map((g,i) => `
    <div style="margin-bottom:12px">
      <b>‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà ${i+1} | ${g.date}</b>
      <table>
        <tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏•‡∏á</th><th>‡πÑ‡∏î‡πâ</th><th>‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th></tr>
        ${g.summary.map(p => `
          <tr>
            <td>${p.name}</td>
            <td>${p.paid}</td>
            <td>${p.win}</td>
            <td style="color:${p.net>=0?'#4caf50':'#f44336'}">${p.net}</td>
          </tr>
        `).join("")}
      </table>
    </div>
  `).join("");
}

/* ‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏∑‡∏ô */
function renderTotalNet() {
  const div = document.getElementById("totalNet");
  const map = {};
  gameHistory.forEach(g =>
    g.summary.forEach(p => {
      if (!map[p.name]) map[p.name] = 0;
      map[p.name] += p.net;
    })
  );

  div.innerHTML = `
    <h3>üî¢ ‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏∑‡∏ô</h3>
    ${Object.entries(map).map(([n,v]) =>
      `<div style="color:${v>=0?'#4caf50':'#f44336'}">${n} : ${v}</div>`
    ).join("")}
  `;
}

function clearLog() {
  if (!confirm("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ")) {
    return;
  }

  if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á: ‡∏•‡∏ö Log ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")) {
    return;
  }

  gameHistory = [];
  localStorage.removeItem("gameHistory");

  renderLogTable();
  document.getElementById("totalNet").innerHTML = "";

  alert("‡∏•‡∏ö Log ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
}


render();
</script>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
function exportLogImage() {
  const div = document.getElementById("logTable");
  if (!div || div.innerHTML.trim() === "") {
    alert("‡πÑ‡∏°‡πà‡∏°‡∏µ Log");
    return;
  }
  html2canvas(div,{scale:2}).then(canvas=>{
    const a=document.createElement("a");
    a.download="bingo-log.png";
    a.href=canvas.toDataURL();
    a.click();
  });
}
</script>

</body>
</html>
